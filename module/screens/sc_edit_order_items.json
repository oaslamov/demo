{
  "code":"sc_edit_order_items:scr@demo1_prvt",
  "label":"$l{Edit order items}l",
  "subject":"$l{Demo1}l",
  "title":"$l{Order}l # ${@screen.order_id}. $l{Edit order items}l",
  "show_in_menu":false,
  "args":[
    {
      "code":"order_id"
    }
  ],
  "grid":{
    "base":"screen",
    "cols":5,
    "rows":5
  },
  "data_sources":[
    {
      "code":"ds_item",
      "table_name":"Demo1_Prvt.Shipping_Order_Product",
      "type":"table",
      "fields":[
        {
          "code":"comment",
          "label":"$l{f:7ef07d00900b}l",
          "type":"string",
          "hint":"$l{f:7ef07d00900b:d}l"
        },
        {
          "code":"id",
          "type":"string"
        },
        {
          "code":"price",
          "label":"$l{f:7ef07d009011}l",
          "type":"number",
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009011:d}l"
        },
        {
          "code":"product",
          "label":"$l{f:7ef07d009008}l",
          "type":"ref",
          "mandatory":true,
          "ref":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "${@ref_filter}"
                ],
                "tablename":"Demo1_Prvt.Product"
              },
              "fields":[
                "id",
                "@name"
              ]
            }
          },
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009008:d}l"
        },
        {
          "code":"quantity",
          "label":"$l{f:7ef07d00900a}l",
          "type":"integer",
          "hint":"$l{f:7ef07d00900a:d}l"
        },
        {
          "code":"shipping_order",
          "label":"$l{f:7ef07d009006}l",
          "type":"ref",
          "ref":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "${@ref_filter}"
                ],
                "tablename":"Demo1_Prvt.Shipping_Order"
              },
              "fields":[
                "id",
                "@name"
              ]
            }
          },
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009006:d}l"
        },
        {
          "code":"sum",
          "label":"$l{f:7ef07d009012}l",
          "type":"number",
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009012:d}l"
        }
      ],
      "operations":{
        "new":{
          "request":{
            "data":{
              "action":"demo1_prvt.new",
              "args":{
                "tablename":"demo1_prvt.shipping_order_product",
                "fields":{
                  "product":"${ds_product.id}",
                  "shipping_order":"${@screen.order_id}"
                }
              }
            },
            "dependencies":[
              "ds_product.id"
            ]
          }
        }
      },
      "actions":[
        {
          "code":"add",
          "label":"$l{Add this product to order}l",
          "request":{
            "data":{
              "action":"demo1_prvt.insert",
              "args":{
                "fields":"${@all_fields}",
                "tableName":"demo1_prvt.shipping_order_product"
              }
            }
          },
          "freshen":[
            {
              "code":"ds_item_list",
              "type":"all_rows"
            }
          ],
          "enable_condition":"${ds_item.product}>0 & ${ds_item.quantity}>0"
        },
        {
          "code":"myAction",
          "label":"$l{MyAction}l",
          "type":"close",
          "request":{
            "data":{
              "action":"demo1_prvt.myAction",
              "args":{
                "input":"Closing"
              }
            }
          },
          "enable_condition":"${ds_item.product}>0 & ${ds_item.quantity}>0"
        }
      ]
    },
    {
      "code":"ds_product",
      "table_name":"Demo1_Prvt.Product",
      "type":"table",
      "rowMarker":{
        "type":"strikethrough",
        "foreignDs":"ds_item_list",
        "columnMap":{
          "id":"product"
        }
      },
      "fields":[
        {
          "code":"id",
          "type":"string"
        },
        {
          "code":"name",
          "label":"$l{f:7ef07d007006}l",
          "type":"string",
          "hint":"$l{f:7ef07d007006:d}l"
        },
        {
          "code":"price",
          "label":"$l{f:7ef07d007009}l",
          "type":"number",
          "hint":"$l{f:7ef07d007009:d}l"
        },
        {
          "code":"product_type",
          "label":"$l{f:7ef07d007008}l",
          "type":"enum",
          "enum":[
            {
              "label":"$l{e:7ef07d007008.T}l",
              "value":"T"
            },
            {
              "label":"$l{e:7ef07d007008.B}l",
              "value":"B"
            },
            {
              "label":"$l{e:7ef07d007008.G}l",
              "value":"G"
            }
          ],
          "hint":"$l{f:7ef07d007008:d}l"
        },
        {
          "code":"url",
          "label":"$l{f:7ef07d00700a}l",
          "type":"string",
          "hint":"$l{f:7ef07d00700a:d}l"
        }
      ],
      "operations":{
        "select":{
          "request":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "${@user_filter}",
                  "order by name"
                ],
                "tablename":"demo1_prvt.product"
              },
              "fields":[
                "id",
                "name",
                "price",
                "product_type"
              ]
            }
          }
        }
      }
    },
    {
      "code":"ds_item_list",
      "table_name":"Demo1_Prvt.Shipping_Order_Product",
      "type":"table",
      "fields":[
        {
          "code":"comment",
          "label":"$l{f:7ef07d00900b}l",
          "type":"string",
          "hint":"$l{f:7ef07d00900b:d}l"
        },
        {
          "code":"id",
          "type":"string"
        },
        {
          "code":"price",
          "label":"$l{f:7ef07d009011}l",
          "type":"number",
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009011:d}l"
        },
        {
          "code":"product",
          "label":"$l{f:7ef07d009008}l",
          "type":"ref",
          "ref":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "${@ref_filter}"
                ],
                "tablename":"Demo1_Prvt.Product"
              },
              "fields":[
                "id",
                "@name"
              ]
            }
          },
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009008:d}l"
        },
        {
          "code":"quantity",
          "label":"$l{f:7ef07d00900a}l",
          "type":"integer",
          "hint":"$l{f:7ef07d00900a:d}l"
        },
        {
          "code":"shipping_order",
          "label":"$l{f:7ef07d009006}l",
          "type":"ref",
          "ref":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "${@ref_filter}"
                ],
                "tablename":"Demo1_Prvt.Shipping_Order"
              },
              "fields":[
                "id",
                "@name"
              ]
            }
          },
          "hint":"$l{f:7ef07d009006:d}l"
        },
        {
          "code":"sum",
          "label":"$l{f:7ef07d009012}l",
          "type":"number",
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009012:d}l"
        },
        {
          "code":"item_order",
          "label":"$l{f:7ef07d009013}l",
          "type":"float64",
          "edit_condition":"false",
          "hint":"$l{f:7ef07d009013:d}l"
        }
      ],
      "operations":{
        "select":{
          "request":{
            "data":{
              "action":"demo1_prvt.selectList",
              "args":{
                "filter":[
                  "shipping_order=${@screen.order_id}"
                ],
                "tablename":"demo1_prvt.shipping_order_product"
              }
            }
          }
        },
        "update":{
          "request":{
            "data":{
              "action":"demo1_prvt.update",
              "args":{
                "tablename":"demo1_prvt.shipping_order_product",
                "fields":"${@all_fields}"
              }
            }
          }
        },
        "delete":{
          "request":{
            "data":{
              "action":"demo1_prvt.deleteById",
              "args":{
                "id":"${id}",
                "tablename":"demo1_prvt.shipping_order_product"
              }
            }
          }
        }
      },
      "actions":[
        {
          "code":"up",
          "label":"$l{Up}l",
          "type":"update",
          "icon":"fas fa-arrow-up",
          "request":{
            "data":{
              "action":"demo1_prvt.updateRowOrder",
              "args":{
                "isFast":"${@special.ctrlkey}",
                "query":"shipping_order=${@screen.order_id}",
                "orderFieldName":"item_order",
                "fields":"${@all_fields}",
                "isDown":"false",
                "tableName":"demo1_prvt.shipping_order_product"
              }
            }
          },
          "freshen":[
            {
              "type":"all_rows"
            }
          ]
        },
        {
          "code":"down",
          "label":"$l{Down}l",
          "type":"update",
          "icon":"fas fa-arrow-down",
          "request":{
            "data":{
              "action":"demo1_prvt.updateRowOrder",
              "args":{
                "isFast":"${@special.ctrlkey}",
                "query":"shipping_order=${@screen.order_id}",
                "orderFieldName":"item_order",
                "fields":"${@all_fields}",
                "isDown":"true",
                "tableName":"demo1_prvt.shipping_order_product"
              }
            }
          },
          "freshen":[
            {
              "type":"all_rows"
            }
          ]
        }
      ]
    }
  ],
  "parts":[
    {
      "code":"p_product_list",
      "label":"$l{Available products}l",
      "type":"table",
      "border_type":"none",
      "position":{
        "from_col":1,
        "to_col":2,
        "from_row":1,
        "to_row":5
      },
      "data_source":{
        "code":"ds_product",
        "fields":[
          {
            "code":"name"
          },
          {
            "code":"price"
          },
          {
            "code":"product_type"
          }
        ],
        "operations":[
          "select"
        ]
      }
    },
    {
      "code":"p_item_list",
      "label":"$l{Items in this order}l",
      "type":"table",
      "border_type":"none",
      "position":{
        "from_col":3,
        "to_col":5,
        "from_row":3,
        "to_row":5
      },
      "data_source":{
        "code":"ds_item_list",
        "fields":[
          {
            "code":"product",
            "filter_view":1
          },
          {
            "code":"quantity",
            "filter_view":1
          },
          {
            "code":"price",
            "filter_view":1
          },
          {
            "code":"sum",
            "filter_view":1
          },
          {
            "code":"comment",
            "filter_view":1
          },
          {
            "code":"item_order",
            "filter_view":1,
            "view_condition":"false"
          }
        ],
        "order":[
          {
            "field":"item_order"
          }
        ],
        "operations":[
          "select",
          "update",
          "delete"
        ],
        "actions":[
          "up",
          "down"
        ]
      }
    },
    {
      "code":"p_item",
      "label":"$l{Product}l",
      "type":"form",
      "border_type":"none",
      "position":{
        "from_col":3,
        "to_col":5,
        "from_row":1,
        "to_row":2
      },
      "data_source":{
        "code":"ds_item",
        "fields":[
          {
            "code":"product"
          },
          {
            "code":"quantity"
          },
          {
            "code":"comment"
          }
        ],
        "operations":[
          "new"
        ],
        "actions":[
          "add"
        ]
      }
    }
  ]
}